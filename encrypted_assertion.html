<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Encrypted SAML Response | express-saml2</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.4.3">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
    

        
    
    
    <link rel="next" href="./work_examples.html" />
    
    
    <link rel="prev" href="./signed_saml_response.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="1.3.5" data-basepath="." data-revision="Tue Oct 27 2015 16:06:16 GMT+0800 (HKT)">
    

<div class="book-summary">
    <div class="book-search" role="search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Home
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="basics.html">
            
                
                    <a href="./basics.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Basics
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="knowledge.html">
            
                
                    <a href="./knowledge.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Knowledge
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="basic_identity_provider.html">
            
                
                    <a href="./basic_identity_provider.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Identity Provider
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="basic_service_provider.html">
            
                
                    <a href="./basic_service_provider.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Service Provider
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="send_a_saml_request.html">
            
                
                    <a href="./send_a_saml_request.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.1.</b>
                        
                        SAML Request
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="signed_saml_request.html">
            
                
                    <a href="./signed_saml_request.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.2.</b>
                        
                        Signed SAML Request
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="receive_a_saml_response.html">
            
                
                    <a href="./receive_a_saml_response.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.3.</b>
                        
                        SAML Response
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="signed_saml_response.html">
            
                
                    <a href="./signed_saml_response.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.4.</b>
                        
                        Signed SAML Response
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="1.3.5" data-path="encrypted_assertion.html">
            
                
                    <a href="./encrypted_assertion.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.5.</b>
                        
                        Encrypted SAML Response
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="work_examples.html">
            
                
                    <a href="./work_examples.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        Work with OneLogin
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="advanced.html">
            
                
                    <a href="./advanced.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Advanced
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="configuration_without_metadata.html">
            
                
                    <a href="./configuration_without_metadata.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Configuration without metadata
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="custom_templates.html">
            
                
                    <a href="./custom_templates.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Custom templates
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="multiple_entities.html">
            
                
                    <a href="./multiple_entities.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Multiple entities
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="metadata_distribution.html">
            
                
                    <a href="./metadata_distribution.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        Metadata distribution
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >express-saml2</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="encrypted-assertion">Encrypted Assertion</h1>
<p>According to the guideline of SAML, our module leaves some security options for developers. If the assertion contains some sensitive information, Identity Provider may want to do encryption. In IdP&apos;s construction, add the following settings as follow:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> saml = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;express-saml2&apos;</span>);
<span class="hljs-keyword">var</span> setting = {
    isAssertionEncrypted: <span class="hljs-literal">true</span>,
    encPrivateKeyFile: <span class="hljs-string">&apos;./key/idp/encryptKey.pem&apos;</span>,
    encPrivateKeyFilePass: <span class="hljs-string">&apos;9Ehf1bcRmp8We9g7hGPxT5QeP2qzTALN&apos;</span>
};
<span class="hljs-keyword">var</span> idp = saml.IdentityProvider(setting, <span class="hljs-string">&apos;./metadata_idp.xml&apos;</span>);
</code></pre>
<p>If you remember SP configuration for signing a request, there are two parameters in the setting object. They are <code>privateKeyFile</code> and <code>privateKeyFilePass</code>. <strong>Warning:</strong> If you are applying our solution instead of another 3rd party IdP, it&apos;s suggested not to use same key for both signing and encryption.</p>
<p>In IdP&apos;s metadata, the certificate must be included in order to decrypt the assertion.</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">KeyDescriptor</span> <span class="hljs-attribute">use</span>=<span class="hljs-value">&quot;encryption&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">KeyInfo</span> <span class="hljs-attribute">xmlns:ds</span>=<span class="hljs-value">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">X509Data</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">X509Certificate</span>&gt;</span>MIID6TCCAtGg...<span class="hljs-tag">&lt;/<span class="hljs-title">X509Certificate</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">X509Data</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">KeyInfo</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">KeyDescriptor</span>&gt;</span>
</code></pre>
<p><strong>The sample encrypted response with signature:</strong></p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-title">samlp:Response</span> <span class="hljs-attribute">xmlns:samlp</span>=<span class="hljs-value">&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot;</span> <span class="hljs-attribute">xmlns:saml</span>=<span class="hljs-value">&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;</span> <span class="hljs-attribute">ID</span>=<span class="hljs-value">&quot;_8e8dc5f69a98cc4c1ff3427e5ce34606fd672f91e6&quot;</span> <span class="hljs-attribute">Version</span>=<span class="hljs-value">&quot;2.0&quot;</span> <span class="hljs-attribute">IssueInstant</span>=<span class="hljs-value">&quot;2014-07-17T01:01:48Z&quot;</span> <span class="hljs-attribute">Destination</span>=<span class="hljs-value">&quot;http://sp.example.com/demo1/index.php?acs&quot;</span> <span class="hljs-attribute">InResponseTo</span>=<span class="hljs-value">&quot;_446395c4e751297f8900b53b066873d5fee011e5&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">saml:Issuer</span>&gt;</span>https://idp.example.com/metadata<span class="hljs-tag">&lt;/<span class="hljs-title">saml:Issuer</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">samlp:Status</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">samlp:StatusCode</span> <span class="hljs-attribute">Value</span>=<span class="hljs-value">&quot;urn:oasis:names:tc:SAML:2.0:status:Success&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">samlp:Status</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">saml:EncryptedAssertion</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">xenc:EncryptedData</span> <span class="hljs-attribute">Type</span>=<span class="hljs-value">&quot;http://www.w3.org/2001/04/xmlenc#Element&quot;</span> <span class="hljs-attribute">xmlns:xenc</span>=<span class="hljs-value">&quot;http://www.w3.org/2001/04/xmlenc#&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">xenc:EncryptionMethod</span> <span class="hljs-attribute">Algorithm</span>=<span class="hljs-value">&quot;http://www.w3.org/2001/04/xmlenc#aes256-cbc&quot;</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">KeyInfo</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">e:EncryptedKey</span> <span class="hljs-attribute">xmlns:e</span>=<span class="hljs-value">&quot;http://www.w3.org/2001/04/xmlenc#&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">e:EncryptionMethod</span> <span class="hljs-attribute">Algorithm</span>=<span class="hljs-value">&quot;http://www.w3.org/2001/04/xmlenc#rsa-1_5&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">DigestMethod</span> <span class="hljs-attribute">Algorithm</span>=<span class="hljs-value">&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">e:EncryptionMethod</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">KeyInfo</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">X509Data</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">X509Certificate</span>&gt;</span>MIIDozCCAougAwIBAgIJAKNsmL8QbfpwMA0GCSqGSIb3DQEBCwUAMGgxCzAJBgNVBAYTAkhLMRIwEAYDVQQIDAlIb25nIEtvbmcxCzAJBgNVBAcMAkhLMRMwEQYDVQQKDApub2RlLXNhbWwyMSMwIQYJKoZIhvcNAQkBFhRub2RlLnNhbWwyQGdtYWlsLmNvbTAeFw0xNTA3MDUxNzU2NDdaFw0xODA3MDQxNzU2NDdaMGgxCzAJBgNVBAYTAkhLMRIwEAYDVQQIDAlIb25nIEtvbmcxCzAJBgNVBAcMAkhLMRMwEQYDVQQKDApub2RlLXNhbWwyMSMwIQYJKoZIhvcNAQkBFhRub2RlLnNhbWwyQGdtYWlsLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMQJAB8JrsLQbUuJa8akzLqO1EZqClS0tQp+w+5wgufp07WwGn/shma8dcQNj1dbjszI5HBeVFjOKIxlfjmNB9ovhQPstBjP/UPQYp1Ip2IoHCYX9HDgMz3xyXKbHthUzZaECz+p+7WtgwhczRkBLDOm2k15qhPYGPw0vH2zbVRGWUBS9dy2Mp3tqlVbP0xZ9CDNkhCJkV9SMNfoCVW/VYPqK2QBo7ki4obm5x5ixFQSSHsKbVARVzyQH5iNjFe1TdAp3rDwrE5Lc1NQlQaxR5Gnb2NZApDORRZIVlNv2WUdi9QvM0yCzjQ90jP0OAogHhRYaxg0/vgNEye46h+PiY0CAwEAAaNQME4wHQYDVR0OBBYEFEVkjcLAITndky090Ay74QqCmQKIMB8GA1UdIwQYMBaAFEVkjcLAITndky090Ay74QqCmQKIMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEBAG4lYX3KQXenez4LpDnZhcFBEZi9YstUKPF5EKd+WplpVbcTQc1A3/Z+uHRmyV8h+pQzeF6Liob37G87YpacPplJI66cf2Rj7j8hSBNbdr+66E2qpcEhAF1iJmzBNyhb/ydlEuVpn8/EsoP+HvBeiDl5gon3562MzZIgV/pLdTfxHyW6hzAQhjGq2UhcvR+gXNVJvHP2eS4jlHnJkB9bfo0kvf87Q+D6XKX3q5c3mO8tqW6UpqHSC+uLEpzZiNLeuFa4TUIhgBgjDjlRrNDKu8ndancSn3yBHYnqJ2t9cR+coFnnjYABQpNrvk4mtmXY8SXoBzYG9Y+lqeAun6+0YyE=<span class="hljs-tag">&lt;/<span class="hljs-title">X509Certificate</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">X509Data</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">KeyInfo</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">e:CipherData</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">e:CipherValue</span>&gt;</span>gvOB36ehJ4C8O78xe+kmZpFrbtNWSRv4JZsCkD9QM3FVQyy1m0pgZ32m2p9M5Vvu5tr8r5nBl+syqGvCZeZFtvYg+LOwGlzcOKRFbfOlmmB6LwBcNsFvujeoEXVgJW/vF/yJcqBODyq5EpUbUmYpnUov6qnatHkAYhKfHS5UtNRY+mden3Sh89y0k3NFz1qH1LZPppQTti764c8+ML1WFa+jgdUba9t6uu1XBoHvzy9XeptdKgT2HGx/TGAmylSmzChlgwjopsCkK+3HoLsfy613/bAqTyxPU2JjlBUjy8RwK6tbofpTJpak+bbPxQBp+SOxAOetAesYuinG1uNpkA==<span class="hljs-tag">&lt;/<span class="hljs-title">e:CipherValue</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">e:CipherData</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">e:EncryptedKey</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">KeyInfo</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">xenc:CipherData</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">xenc:CipherValue</span>&gt;</span>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<span class="hljs-tag">&lt;/<span class="hljs-title">xenc:CipherValue</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">xenc:CipherData</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">xenc:EncryptedData</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">saml:EncryptedAssertion</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Signature</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">SignedInfo</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">CanonicalizationMethod</span> <span class="hljs-attribute">Algorithm</span>=<span class="hljs-value">&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">SignatureMethod</span> <span class="hljs-attribute">Algorithm</span>=<span class="hljs-value">&quot;http://www.w3.org/2000/09/xmldsig#rsa-sha1&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">Reference</span> <span class="hljs-attribute">URI</span>=<span class="hljs-value">&quot;#_d71a3a8e9fcc45c9e9d248ef7049393fc8f04e5f75&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">Transforms</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">Transform</span> <span class="hljs-attribute">Algorithm</span>=<span class="hljs-value">&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">Transforms</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">DigestMethod</span> <span class="hljs-attribute">Algorithm</span>=<span class="hljs-value">&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">DigestValue</span>&gt;</span>upUaQyNo8KYfaugAsM9I6e/HYNQ=<span class="hljs-tag">&lt;/<span class="hljs-title">DigestValue</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">Reference</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">SignedInfo</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">SignatureValue</span>&gt;</span>T3eM5SxwxP8wH+w1jxH/YezcsC03xU0N19uEggWbL//adCbdvPEWqnYDRlRi6HqdfLTAxqt0LqXzy4Sx2Sj/G3dKA1fTu8qZueqg1oTdKIHEO7BKQlWj+vhsxP4RJwOaooZ195Ez0DsqBjIYM8O+hrmGCpKoJNz7ZaASDhnBBqg4UyilA/VXwP2Wq/LwXdQQ+SfgbtmqxfrcqRQtN87aL3YdPFoS4oR6Q8d97g+YiSbsSvTrxfU5vDEo1tRKxvAQXDDxRBral9kELhqcd3Aumcr9zPF00KxkYIAKtyWd5RsWgOcfbiEQpCit0vh74Y1HplLhzeLhPI/RrLB5gSI4DA==<span class="hljs-tag">&lt;/<span class="hljs-title">SignatureValue</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">Signature</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">samlp:Response</span>&gt;</span>
</code></pre>
<p>Now all you need to do is to use <code>sp.parseLoginResponse</code> again to parse and verify the response.</p>
<pre><code class="lang-javascript">router.post(<span class="hljs-string">&apos;/acs&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>{
    sp.parseLoginResponse(idp, <span class="hljs-string">&apos;post&apos;</span>, req, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parseResult</span>) </span>{
        <span class="hljs-comment">// Use the parseResult can do customized action</span>
    });
});
</code></pre>
<p>Currently, we support the following encrpytion algorithms:</p>
<p><strong>Data encryption algorithms</strong></p>
<ul>
<li><a href="http://www.w3.org/2001/04/xmlenc#tripledes-cbc" target="_blank">http://www.w3.org/2001/04/xmlenc#tripledes-cbc</a></li>
<li><a href="http://www.w3.org/2001/04/xmlenc#aes128-cbc" target="_blank">http://www.w3.org/2001/04/xmlenc#aes128-cbc</a></li>
<li><a href="http://www.w3.org/2001/04/xmlenc#aes256-cbc" target="_blank">http://www.w3.org/2001/04/xmlenc#aes256-cbc</a></li>
</ul>
<p><strong>Key encryption algorithms</strong></p>
<ul>
<li><a href="http://www.w3.org/2001/04/xmlenc#rsa-1_5" target="_blank">http://www.w3.org/2001/04/xmlenc#rsa-1_5</a></li>
<li><a href="http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p" target="_blank">http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p</a></li>
</ul>
<p>Credits to <a href="https://github.com/auth0/node-xml-encryption" target="_blank">auth0/node-xml-encryption</a></p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./signed_saml_response.html" class="navigation navigation-prev " aria-label="Previous page: Signed SAML Response"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./work_examples.html" class="navigation navigation-next " aria-label="Next page: Work with OneLogin"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
